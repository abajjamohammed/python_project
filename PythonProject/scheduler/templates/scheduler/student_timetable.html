{% extends 'scheduler/base.html' %}
{% block dynamic_title %}Time-Table{% endblock dynamic_title %}
{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold">Time-Table</h2>
        <button onclick="window.print();" class="btn btn-outline-dark shadow-sm px-4 no-print">
            <i class="fas fa-print me-2"></i> Imprimer (PDF)
        </button>
    </div>

    <div class="card border-0 shadow-sm" style="border-radius: 12px;">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-bordered mb-0 text-center align-middle">
                    <thead class="bg-light">
                        <tr>
                            <th class="py-3 text-muted small fw-bold" style="width: 100px;">TIME</th>
                            {% for day in days %}
                            <th class="py-3 text-dark fw-bold">{{ day|upper }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for hour in hours %}
                        <tr>
                            <td class="fw-bold text-muted py-4">{{ hour }}:00</td>
                            {% for day in days %}
                            <td class="p-2" style="height: 120px; min-width: 160px; background-color: #fcfcfc;">
                                {% for session in sessions %}
                                    {% if session.day == day and session.start_hour == hour %}
                                    <div class="p-3 shadow-sm text-start" 
                                         style="background-color: #eef4ff; border-left: 4px solid #0d6efd; border-radius: 8px;">
                                        <div class="text-primary fw-bold small">{{ session.course.name|upper }}</div>
                                        <div class="text-muted" style="font-size: 0.75rem;">Room {{ session.room.name }}</div>
                                        <div class="mt-2 fw-bold" style="font-size: 0.65rem; color: #6c757d;">GROUP: {{ student_group }}</div>
                                    </div>
                                    {% endif %}
                                {% endfor %}
                            </td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<style>
@media print {
    /* 1. Hide UI elements */
    .sidebar-wrapper, .top-navbar, .no-print, .btn, .logout-button, aside, nav, .vr {
        display: none !important;
    }
    
    /* 2. Reset layout */
    .main-wrapper, main, .content-area, .container, .container-fluid {
        margin: 0 !important;
        padding: 0 !important;
        width: 100% !important;
        display: block !important;
    }

    /* 3. Force One-Page Vertical Fit */
    table {
        font-size: 8.5pt !important; /* Slightly smaller font */
        width: 100% !important;
        border-collapse: collapse !important;
        table-layout: fixed !important; /* Forces equal column widths */
    }

    /* This is the secret: shrink the row height */
    th {
        padding: 6px !important;
        background-color: #f8f9fa !important;
        -webkit-print-color-adjust: exact;
    }

    td {
        height: 60px !important; /* Fixed height to force it to fit on one page */
        padding: 2px !important; 
        border: 1px solid #dee2e6 !important;
    }

    /* Shrink the session boxes so they don't stretch the cells */
    .p-3 {
        padding: 5px !important;
        margin: 0 !important;
    }

    .card-body {
        padding: 0 !important;
    }

    /* 4. Auto-Landscape and tight margins */
    @page {
        size: landscape;
        margin: 0.5cm; /* Smaller margin gives more room for the table */
    }
}
</style>
{% endblock %}